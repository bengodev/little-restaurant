{% extends "admin/base.html" %}
{% load static %}

{% block extrahead %}
    {{ block.super }}

    <!-- 1.  Toast CSS (tiny, inline) -->
    <style>
        #toast{
            position:fixed; top:20px; right:20px;
            background:#28a745; color:#fff; padding:10px 14px;
            border-radius:4px; z-index:9999; display:none;
            font-size:14px; box-shadow:0 2px 8px rgba(0,0,0,.2);
        }
    </style>

    <!-- 2.  WebSocket script -->
  
{% if user.is_superuser or 'staff' in user.group.all|join:" " %}

      <script>
      console.log('New WebSocket line creating');

      const ws = new WebSocket(`ws://${window.location.host}/ws/booking/`);

      ws.onopen = function() {
          console.log('WebSocket connection opened');
      };

      ws.onmessage = function(e) {
          const msg = JSON.parse(e.data);
          console.log("new row:", msg.data);
          new Audio("{% static 'upbeat.mp3' %}").play();
      };

      ws.onclose = function() {
          console.log('WebSocket connection closed');
      };

      ws.onerror = function(error) {
          console.log('WebSocket error: ', error);
      };
  </script>
{% endif %}
{% endblock %}
